<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>College Softball Insights – SEC Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Inter, sans-serif;
      background: #f8f9fb;
      color: #1a1a1d;
    }

    header {
      background: #ffffff;
      border-bottom: 1px solid #e3e7ee;
      padding: 18px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .title {
      font-size: 22px;
      font-weight: 600;
      margin: 0;
    }
    .subtitle {
      font-size: 13px;
      color: #6d6d72;
      margin-top: 4px;
    }

    main {
      max-width: 1100px;
      margin: 28px auto 80px;
      padding: 0 20px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }

    .summary-card {
      background: #ffffff;
      padding: 18px;
      border-radius: 12px;
      border: 1px solid #e4e7f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .summary-label {
      font-size: 12px;
      color: #6f7285;
      text-transform: uppercase;
      letter-spacing: .07em;
      margin-bottom: 6px;
    }

    .summary-value {
      font-size: 24px;
      font-weight: 600;
    }

    /* Controls */
    .controls {
      display: grid;
      grid-template-columns: 2fr repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 30px;
    }

    input, select {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d4d7e2;
      font-size: 14px;
      outline: none;
      background: #fff;
    }

    input:focus, select:focus {
      border-color: #4a8df2;
      box-shadow: 0 0 0 2px rgba(74,141,242,0.2);
    }

    /* Chart Card */
    .chart-card {
      background: #ffffff;
      border: 1px solid #e4e7f0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 26px;
    }
    .chart-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 14px;
    }

    #chartWrapper {
      height: 260px;  /* FIXES SCROLL BUG */
      position: relative;
    }

    /* Teams Grid */
    .teams-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .team-card {
      background: white;
      padding: 18px 18px 12px;
      border-radius: 10px;
      border: 1px solid #e4e7f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }

    .team-name {
      font-size: 16px;
      font-weight: 600;
    }

    .team-location {
      font-size: 13px;
      color: #6d6d72;
    }

    .pill {
      margin-top: 8px;
      font-size: 12px;
      background: #f1f4fa;
      padding: 4px 8px;
      border-radius: 6px;
      display: inline-block;
    }

    .roster-btn {
      margin-top: 10px;
      padding: 8px 12px;
      font-size: 13px;
      border-radius: 8px;
      border: 1px solid #d4d7e2;
      background: #f7f9fc;
      cursor: pointer;
    }

    .roster {
      margin-top: 12px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s ease;
    }

    .roster.open {
      max-height: 330px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th {
      text-align: left;
      padding: 6px 4px;
      color: #6d6d72;
      font-size: 12px;
      border-bottom: 1px solid #e2e4ea;
    }

    td {
      padding: 6px 4px;
      border-bottom: 1px solid #f2f2f4;
    }

    @media (max-width: 900px) {
      .teams-grid { grid-template-columns: 1fr 1fr; }
      .controls { grid-template-columns: 1fr; }
      .summary-grid { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 600px) {
      .teams-grid { grid-template-columns: 1fr; }
      .summary-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

<header>
  <h1 class="title">College Softball Insights</h1>
  <p class="subtitle">SEC Roster Analytics Dashboard</p>
</header>

<main>

  <!-- SUMMARY -->
  <div class="summary-grid">
    <div class="summary-card">
      <div class="summary-label">Teams</div>
      <div id="summary-teams" class="summary-value">–</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Avg Roster Size</div>
      <div id="summary-avg" class="summary-value">–</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Total Players</div>
      <div id="summary-total" class="summary-value">–</div>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="controls">
    <input id="search" placeholder="Search teams or players…" />
    <select id="filter-pos">
      <option value="">All positions</option>
    </select>
    <select id="filter-class">
      <option value="">All classes</option>
    </select>
    <select id="sort">
      <option value="name">Sort: Name A–Z</option>
      <option value="roster-desc">Sort: Roster Size Desc</option>
      <option value="roster-asc">Sort: Roster Size Asc</option>
    </select>
  </div>

  <!-- CHART -->
  <div class="chart-card">
    <div class="chart-title">Roster Size by Team</div>
    <div id="chartWrapper">
      <canvas id="rosterChart"></canvas>
    </div>
  </div>

  <!-- TEAM CARDS -->
  <div id="teams" class="teams-grid"></div>

</main>

<script>
let teams = [];
let filtered = [];
let chart;

async function loadData() {
  const res = await fetch("softball_sec.json");
  teams = await res.json();

  teams.forEach(t => t.rosterSize = t.players.length);

  filtered = [...teams];

  buildFilters();
  updateSummary();
  renderTeams();
  renderChart();
}

function buildFilters() {
  const posSet = new Set();
  const classSet = new Set();

  teams.forEach(t =>
    t.players.forEach(p => {
      if (p.pos) posSet.add(p.pos);
      if (p.class) classSet.add(p.class);
    })
  );

  for (let pos of posSet) {
    const o = document.createElement("option");
    o.value = pos; o.textContent = pos;
    document.getElementById("filter-pos").appendChild(o);
  }

  for (let c of classSet) {
    const o = document.createElement("option");
    o.value = c; o.textContent = c;
    document.getElementById("filter-class").appendChild(o);
  }

  document.getElementById("search").addEventListener("input", filterData);
  document.getElementById("filter-pos").addEventListener("change", filterData);
  document.getElementById("filter-class").addEventListener("change", filterData);
  document.getElementById("sort").addEventListener("change", sortAndRender);
}

function filterData() {
  const q = document.getElementById("search").value.toLowerCase();
  const pos = document.getElementById("filter-pos").value;
  const cls = document.getElementById("filter-class").value;

  filtered = teams.filter(t => {
    const matchTeam = t.school.toLowerCase().includes(q);
    const matchPlayer = t.players.some(p => p.name.toLowerCase().includes(q));

    let ok = q ? (matchTeam || matchPlayer) : true;

    if (pos) ok = ok && t.players.some(p => p.pos === pos);
    if (cls) ok = ok && t.players.some(p => p.class === cls);

    return ok;
  });

  sortAndRender();
}

function sortAndRender() {
  const s = document.getElementById("sort").value;

  if (s === "name") filtered.sort((a,b) => a.school.localeCompare(b.school));
  if (s === "roster-desc") filtered.sort((a,b) => b.rosterSize - a.rosterSize);
  if (s === "roster-asc") filtered.sort((a,b) => a.rosterSize - b.rosterSize);

  renderTeams();
  renderChart();
  updateSummary();
}

function updateSummary() {
  const totalTeams = filtered.length;
  const totalPlayers = filtered.reduce((a,t) => a + t.rosterSize, 0);
  const avg = totalTeams ? (totalPlayers / totalTeams).toFixed(1) : 0;

  document.getElementById("summary-teams").textContent = totalTeams;
  document.getElementById("summary-total").textContent = totalPlayers;
  document.getElementById("summary-avg").textContent = avg;
}

function renderTeams() {
  const box = document.getElementById("teams");
  box.innerHTML = "";

  filtered.forEach(t => {
    const card = document.createElement("div");
    card.className = "team-card";

    card.innerHTML = `
      <div class="team-name">${t.school}</div>
      <div class="team-location">${t.city}, ${t.state}</div>
      <div class="pill">${t.rosterSize} players</div>
      <button class="roster-btn">View roster</button>
      <div class="roster">${renderRoster(t.players)}</div>
    `;

    const btn = card.querySelector(".roster-btn");
    const r = card.querySelector(".roster");

    btn.onclick = () => r.classList.toggle("open");

    box.appendChild(card);
  });
}

function renderRoster(players) {
  return `
    <table>
      <thead>
        <tr><th>#</th><th>Name</th><th>Pos</th><th>Class</th></tr>
      </thead>
      <tbody>
        ${players
          .map(
            p => `<tr>
                    <td>${p.number || ""}</td>
                    <td>${p.name}</td>
                    <td>${p.pos}</td>
                    <td>${p.class}</td>
                  </tr>`
          )
          .join("")}
      </tbody>
    </table>`;
}

function renderChart() {
  const ctx = document.getElementById("rosterChart").getContext("2d");
  const labels = filtered.map(t => t.school);
  const data = filtered.map(t => t.rosterSize);

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "bar",
    data: { labels, datasets: [{ label: "Roster Size", data, backgroundColor: "#4a8df2" }] },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,  /* prevents scroll jumps */
      scales: {
        x: { ticks: { maxRotation: 70, minRotation: 40 }},
        y: { beginAtZero: true }
      }
    }
  });
}

loadData();
</script>

</body>
</html>
