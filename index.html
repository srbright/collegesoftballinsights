<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>College Softball Insights</title>
  <!-- PRODUCTION TAILWIND (official minified build - no warnings) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { pink: { 600: '#db2777', 700: '#be185d' } } } }
    }
  </script>
<!-- Fuse.js (Search) -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
<!-- Chart.js (Graphs) - This "umd" version is required for standard websites -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    .hero { 
      background: linear-gradient(rgba(0,0,0,0.62), rgba(0,0,0,0.62)), 
                   url('https://justwomenssports.com/wp-content/uploads/2025/06/GettyImages-2219054470-1024x683.jpg') center/cover no-repeat fixed;
      background-attachment: fixed;
    }
    #searchBtn:hover { transform: scale(1.05); }
  </style>
</head>
<body class="font-sans text-gray-800">

  <!-- HERO -->
  <header class="hero h-screen flex items-center justify-center text-white text-center px-6">
    <div class="max-w-5xl z-10">
      <h1 class="text-5xl md:text-7xl font-black mb-8 tracking-tight leading-tight">
        College Softball Insights
      </h1>
      <p class="text-xl md:text-2xl max-w-4xl mx-auto leading-relaxed mb-10 opacity-95">
        Finding the right college softball program begins with clarity. Our tool helps parents and players narrow down options by location, conference, competitive level, enrollment size, class breakdown, retention rates, and coaching stability. Instead of feeling lost in endless choices, you'll have a focused starting point to explore programs that truly match your priorities â€” making the first step in the recruiting process simpler, smarter, and more confident.
      </p>
      <a href="#search" class="inline-block bg-pink-600 hover:bg-pink-700 text-white font-bold py-5 px-12 rounded-full text-xl transition transform hover:scale-105">
        Start Your Search
      </a>
    </div>
  </header>
<!-- START OF FILTER SECTION -->
<div class="bg-white p-6 rounded-lg shadow-md mb-8">
    <h2 class="text-xl font-bold mb-4">Filter Teams</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
        
        <!-- Division Multi-Select -->
        <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-1">Division</label>
            <button onclick="toggleDropdown('divDropdown')" class="w-full text-left border border-gray-300 rounded-md p-2 bg-white flex justify-between items-center">
                <span id="divLabel">All Divisions</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div id="divDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1 p-2">
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="mr-2" value="D1"> NCAA D1</label>
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="mr-2" value="D2"> NCAA D2</label>
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="mr-2" value="D3"> NCAA D3</label>
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="mr-2" value="NAIA"> NAIA</label>
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="mr-2" value="JUCO"> JUCO</label>
            </div>
        </div>

        <!-- Conference Multi-Select -->
        <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-1">Conference</label>
            <button onclick="toggleDropdown('confDropdown')" class="w-full text-left border border-gray-300 rounded-md p-2 bg-white flex justify-between items-center">
                <span id="confLabel">All Conferences</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div id="confDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1 p-2">
                <!-- JS fills this -->
            </div>
        </div>

        <!-- State Multi-Select -->
        <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
            <button onclick="toggleDropdown('stateDropdown')" class="w-full text-left border border-gray-300 rounded-md p-2 bg-white flex justify-between items-center">
                <span id="stateLabel">All States</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div id="stateDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto mt-1 p-2">
                <!-- JS fills this -->
            </div>
        </div>

        <!-- Zip Code -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Zip Code</label>
            <input type="text" id="zipInput" placeholder="e.g. 90210" class="w-full border border-gray-300 rounded-md p-2">
        </div>

        <!-- Radius -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Radius (Miles)</label>
            <input type="number" id="radiusInput" placeholder="e.g. 100" class="w-full border border-gray-300 rounded-md p-2">
        </div>
    </div>

    <!-- Buttons -->
    <div class="mt-6 flex gap-3">
        <button onclick="applyFilters()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition shadow-sm">Apply Filters</button>
        <button onclick="clearFilters()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition shadow-sm">Clear</button>
    </div>
    <p id="locationStatus" class="text-sm text-gray-500 mt-2 font-medium"></p>
</div>
<!-- END OF FILTER SECTION -->
      <h2 class="text-5xl md:text-7xl font-black mb-8 tracking-tight">
        Find Potential Colleges
      </h2>
      <p class="text-xl md:text-2xl text-gray-700 mb-12 max-w-4xl mx-auto">
        Type in natural language what you are looking for in your college softball team
      </p>

      <div class="relative max-w-4xl mx-auto">
        <input 
          type="text" 
          id="aiSearchInput" 
          placeholder="e.g. SEC schools in Texas adding lots of freshmen, warm weather teams with 80% win rate..." 
          class="w-full p-7 text-xl bg-white border-4 border-pink-200 rounded-3xl shadow-2xl focus:border-pink-600 focus:outline-none pr-24"
          autofocus />
        <button id="searchBtn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-pink-600 hover:bg-pink-700 text-white font-bold px-10 py-5 rounded-3xl transition">
          Search
        </button>
      </div>

      <p class="text-sm text-gray-500 mt-6">Powered by Grok â€¢ Real-time AI understanding</p>
    </div>

    <div id="explanation" class="max-w-4xl mx-auto mt-12 p-8 bg-blue-50 rounded-2xl text-lg font-medium hidden"></div>
    <div id="results" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10 mt-16 px-6"></div>
    <p class="text-center text-gray-500 mt-12 text-lg" id="noResults">Loading programs...</p>
  </section>

  <!-- TEAM DETAIL -->
  <section id="teamDetails" class="py-20 bg-gray-50 hidden">
    <div class="max-w-6xl mx-auto px-6">
      <div class="text-center mb-10">
        <h2 id="detailTitle" class="text-5xl font-bold mb-4"></h2>
        <div id="netChange" class="inline-flex items-center px-6 py-3 rounded-full font-bold text-xl"></div>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl p-8 mb-12">
        <h3 class="text-3xl font-bold text-center mb-6">2025 to 2026 Roster Change Summary</h3>
        <table class="w-full text-lg mb-8">
          <thead class="bg-gray-100"><tr><th class="p-5 text-left">Added</th><th class="p-5 text-left">Left</th><th class="p-5 text-left font-bold">Net Change</th></tr></thead>
          <tbody id="rosterChangeTable"></tbody>
        </table>
        <p class="text-center text-sm text-gray-600"><strong>Newcomers:</strong> <span id="newcomerBreakdown"></span></p>
      </div>

      <div class="grid md:grid-cols-2 gap-12 mb-12">
        <div class="bg-white p-8 rounded-2xl shadow-2xl"><canvas id="classChart"></canvas></div>
        <div class="bg-white p-8 rounded-2xl shadow-2xl"><canvas id="positionChart"></canvas></div>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
        <h3 class="text-3xl font-bold p-8 bg-pink-50 text-center">Full 2026 Roster</h3>
        <div class="overflow-x-auto">
          <table class="w-full" id="rosterTable">
            <thead class="bg-pink-100">
              <tr><th class="p-5 text-left">Player</th><th class="p-5 text-center">Pos</th><th class="p-5 text-center">Class</th></tr>
            </thead>
            <tbody class="divide-y"></tbody>
          </table>
        </div>
      </div>

      <button onclick="closeDetails()" class="mt-12 block mx-auto bg-pink-600 hover:bg-pink-700 text-white font-bold py-5 px-12 rounded-full text-xl transition">
        Back to Search
      </button>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-24 bg-pink-600 text-white text-center">
    <h2 class="text-5xl md:text-6xl font-black mb-6">Launch Special: $99 First Year</h2>
    <p class="text-2xl mb-10">Limited to first 100 families</p>
    <a href="#" class="bg-white text-pink-600 hover:bg-gray-100 font-black text-2xl py-6 px-16 rounded-full transition transform hover:scale-105">
      Claim Your Spot Now
    </a>
  </section>

  <footer class="bg-gray-900 text-white py-10 text-center text-sm">
    Â© 2025 College Softball Insights â€¢ Real-time roster data â€¢ Powered by Grok AI
  </footer>

  <script>
    let allTeams = [], fuse, classChart = null, positionChart = null;
    const XAI_API_KEY = 'xai-dEQaTjpf1wXo9OFgveiAksjyhZlCo59vwEhXldUdAxTquerIfvNP6p7P4RtNi0DPFppdMz4TmtyhnhpV';
    const XAI_URL = 'https://api.x.ai/v1/chat/completions';

    fetch('teams.json')
      .then(r => r.json())
      .then(data => {
        allTeams = data;
        populateDropdowns(data);
        fuse = new Fuse(allTeams, {keys: ['name','conf','state'], threshold: 0.3});
        renderResults(allTeams.slice(0,12));
        document.getElementById('noResults').textContent = '34 programs loaded â€” type above to search';
      })
      .catch(err => {
        console.error('Data error:', err);
        document.getElementById('noResults').textContent = 'teams.json missing â€” re-upload to repo';
      });

    document.getElementById('searchBtn').addEventListener('click', runAISearch);
    document.getElementById('aiSearchInput').addEventListener('keypress', e => { if (e.key === 'Enter') runAISearch(); });

    async function runAISearch() {
      const query = document.getElementById('aiSearchInput').value.trim();
      if (!query) {
        renderResults(allTeams.slice(0,12));
        return;
      }

      document.getElementById('noResults').textContent = 'Grok is thinking...';
      document.getElementById('results').innerHTML = '';
      document.getElementById('explanation').classList.add('hidden');

      try {
        const response = await fetch(XAI_URL, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${XAI_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: 'grok-beta',
            messages: [
              { role: 'system', content: `You are a softball recruiting expert. Filter this data for the query. Return ONLY JSON: {"matches": [teams], "explanation": "short summary"}. Data: ${JSON.stringify(allTeams)}` },
              { role: 'user', content: query }
            ],
            temperature: 0.2,
            max_tokens: 1200
          })
        });

        const result = await response.json();
        const content = result.choices[0].message.content.trim();
        const { matches, explanation } = JSON.parse(content);

        renderResults(matches.length ? matches : allTeams.slice(0,8));
        document.getElementById('explanation').innerHTML = `<p class="text-xl">${explanation}</p>`;
        document.getElementById('explanation').classList.remove('hidden');
        document.getElementById('noResults').textContent = '';

      } catch (err) {
        console.error('AI failed:', err);
        const fallback = fuse.search(query).map(r => r.item);
        renderResults(fallback.length ? fallback : allTeams.slice(0,8));
        document.getElementById('explanation').innerHTML = '<p class="text-xl">Grok activating â€” showing keyword matches.</p>';
        document.getElementById('explanation').classList.remove('hidden');
      }
    }

    function renderResults(teams) {
    const tableBody = document.getElementById('resultsBody');
    const noResults = document.getElementById('noResults');
    const resultCount = document.getElementById('resultCount');

    // Update count
    if (resultCount) resultCount.textContent = `Found ${teams.length} teams`;

    // If no teams found
    if (teams.length === 0) {
        if (noResults) noResults.classList.remove('hidden');
        if (tableBody) tableBody.innerHTML = '';
        return;
    }

    // Hide "No Results" message
    if (noResults) noResults.classList.add('hidden');

    // Render the table rows
    if (tableBody) {
        tableBody.innerHTML = teams.map(team => {
            // SAFE DATA CHECKING (Prevents the crash)
            const school = team.school || team.name || "Unknown School";
            const mascot = team.mascot || "-";
            const conf = team.conference || team.conf || "-";
            const location = (team.city && team.state) ? `${team.city}, ${team.state}` : (team.state || "-");
            const url = team.url || "#";

            return `
            <tr class="hover:bg-gray-50 transition border-b border-gray-100">
                <td class="px-6 py-4 font-medium text-gray-900">${school}</td>
                <td class="px-6 py-4 text-gray-600">${mascot}</td>
                <td class="px-6 py-4 text-gray-600">
                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">
                        ${conf}
                    </span>
                </td>
                <td class="px-6 py-4 text-gray-600">${location}</td>
                <td class="px-6 py-4">
                    <a href="${url}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium hover:underline">
                        Visit
                    </a>
                </td>
            </tr>
            `;
        }).join('');
    }
}

    window.showTeam = function(name) {
      const team = allTeams.find(t => t.name === name);
      if (!team) return;
      document.getElementById('search').classList.add('hidden');
      document.getElementById('teamDetails').classList.remove('hidden');
      document.getElementById('detailTitle').textContent = team.name;

      const net = team.net;
      const netEl = document.getElementById('netChange');
      netEl.textContent = net > 0 ? `+${net} Net Growth` : `${net} Change`;
      netEl.className = net > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
      netEl.classList.add('px-6','py-3','rounded-full','font-bold','text-xl');

      document.getElementById('rosterChangeTable').innerHTML = `
        <tr><td class="p-5">${team.newcomers} added</td>
            <td class="p-5">${team.transfersOut || 'â€”'}</td>
            <td class="p-5 font-bold text-2xl ${net>0?'text-green-600':'text-red-600'}">${net>0?'+'+net:net}</td></tr>`;

      document.getElementById('newcomerBreakdown').textContent = `${team.newcomers} total (${team.roster.Fr} freshmen + ${team.transfersIn} transfers)`;

      if (classChart) classChart.destroy();
      if (positionChart) positionChart.destroy();
      const total = Object.values(team.roster).reduce((a,b)=>a+b,0);
      classChart = new Chart(document.getElementById('classChart'), {
        type: 'doughnut',
        data: { labels: ['Fr','So','Jr','Sr','Gr'], datasets: [{ data: Object.values(team.roster), backgroundColor: ['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FECA57'] }] },
        options: { plugins: { title: { display: true, text: `Class Breakdown (${total} players)` } } }
      });
      positionChart = new Chart(document.getElementById('positionChart'), {
        type: 'bar',
        data: { labels: Object.keys(team.positions), datasets: [{ label: 'Players', data: Object.values(team.positions), backgroundColor: '#FF6B6B' }] },
        options: { plugins: { title: { display: true, text: 'By Position' } } }
      });

      const tbody = document.querySelector('#rosterTable tbody');
      tbody.innerHTML = (team.players || []).map(p => `
        <tr class="hover:bg-pink-50">
          <td class="p-5">${p.name}</td>
          <td class="p-5 text-center font-medium">${p.pos}</td>
          <td class="p-5 text-center">${p.class}</td>
        </tr>`).join('') || '<tr><td colspan="3" class="p-12 text-center text-gray-500">Roster loading...</td></tr>';
    }

    function closeDetails() {
      document.getElementById('teamDetails').classList.add('hidden');
      document.getElementById('search').classList.remove('hidden');
      window.scrollTo(0,0);
    }
 // --- MULTI-SELECT FILTER LOGIC ---

// 1. Helper to Toggle Dropdowns
function toggleDropdown(id) {
    const el = document.getElementById(id);
    // Close others
    document.querySelectorAll('[id$="Dropdown"]').forEach(d => {
        if(d.id !== id) d.classList.add('hidden');
    });
    el.classList.toggle('hidden');
}

// Close dropdowns if clicking outside
window.onclick = function(event) {
    if (!event.target.closest('.relative')) {
        document.querySelectorAll('[id$="Dropdown"]').forEach(el => el.classList.add('hidden'));
    }
}

// 2. Populate Checkboxes
function populateDropdowns(data) {
    const conferences = [...new Set(data.map(t => t.conf || t.conference).filter(Boolean))].sort();
    const states = [...new Set(data.map(t => t.state).filter(Boolean))].sort();

    const fillContainer = (id, items) => {
        const container = document.getElementById(id);
        container.innerHTML = ''; 
        items.forEach(item => {
            container.innerHTML += `
                <label class="flex items-center p-2 hover:bg-gray-100 cursor-pointer">
                    <input type="checkbox" class="mr-2" value="${item}"> ${item}
                </label>`;
        });
    };

    fillContainer('confDropdown', conferences);
    fillContainer('stateDropdown', states);
}

// 3. Get Selected Values
function getCheckedValues(dropdownId) {
    const container = document.getElementById(dropdownId);
    const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
    return Array.from(checkboxes).map(cb => cb.value);
}

// 4. Apply Filters
async function applyFilters() {
    const selectedDivs = getCheckedValues('divDropdown');
    const selectedConfs = getCheckedValues('confDropdown');
    const selectedStates = getCheckedValues('stateDropdown');
    
    // Update UI Labels
    document.getElementById('divLabel').textContent = selectedDivs.length ? `${selectedDivs.length} Selected` : 'All Divisions';
    document.getElementById('confLabel').textContent = selectedConfs.length ? `${selectedConfs.length} Selected` : 'All Conferences';
    document.getElementById('stateLabel').textContent = selectedStates.length ? `${selectedStates.length} Selected` : 'All States';

    // Handle Zip/Radius
    const zip = document.getElementById('zipInput').value;
    const radius = parseFloat(document.getElementById('radiusInput').value);
    let userLat = null, userLon = null;

    if (zip && radius) {
        document.getElementById('locationStatus').textContent = "ðŸ“ Locating...";
        try {
            const res = await fetch(`https://api.zippopotam.us/us/${zip}`);
            if (!res.ok) throw new Error();
            const d = await res.json();
            userLat = parseFloat(d.places[0].latitude);
            userLon = parseFloat(d.places[0].longitude);
            document.getElementById('locationStatus').textContent = `ðŸ“ Searching within ${radius} miles of ${zip}`;
        } catch (e) {
            document.getElementById('locationStatus').textContent = "âŒ Invalid Zip";
            return;
        }
    } else {
        document.getElementById('locationStatus').textContent = "";
    }

    // Filter Loop
    const filtered = allTeams.filter(team => {
        if (selectedDivs.length > 0 && !selectedDivs.includes(team.division || 'D1')) return false;
        if (selectedConfs.length > 0 && !selectedConfs.includes(team.conf || team.conference)) return false;
        if (selectedStates.length > 0 && !selectedStates.includes(team.state)) return false;

        if (userLat && radius) {
            if (!team.latitude || !team.longitude) return false;
            const dist = getDistance(userLat, userLon, team.latitude, team.longitude);
            if (dist > radius) return false;
        }
        return true;
    });

    // Render Results (Re-using your existing logic)
    const tableBody = document.getElementById('resultsBody');
    if(tableBody) {
        tableBody.innerHTML = filtered.map(team => `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">${team.school}</td>
                <td class="px-6 py-4">${team.mascot || '-'}</td>
                <td class="px-6 py-4">${team.conference || team.conf || '-'}</td>
                <td class="px-6 py-4">${team.city || ''}, ${team.state}</td>
                <td class="px-6 py-4">
                    <a href="${team.url || '#'}" target="_blank" class="text-blue-600 hover:underline">Visit</a>
                </td>
            </tr>
        `).join('');
        document.getElementById('resultCount').textContent = `Found ${filtered.length} teams`;
    }
}

function clearFilters() {
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    document.getElementById('zipInput').value = "";
    document.getElementById('radiusInput').value = "";
    document.getElementById('divLabel').textContent = "All Divisions";
    document.getElementById('confLabel').textContent = "All Conferences";
    document.getElementById('stateLabel').textContent = "All States";
    document.getElementById('locationStatus').textContent = "";
    
    // Reset to all teams
    applyFilters(); 
}

// Distance Math
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 3958.8; 
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
              Math.sin(dLon/2) * Math.sin(dLon/2);
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}
  </script>
</body>
</html>
