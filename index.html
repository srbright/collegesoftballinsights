<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>College Softball Insights</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .hero { 
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0,0.6)), 
                   url('https://justwomenssports.com/wp-content/uploads/2025/06/GettyImages-2219054470-1024x683.jpg') center/cover no-repeat fixed; 
    }
    #searchBtn { transition: all 0.3s; }
    #searchBtn:hover { transform: scale(1.05); }
  </style>
</head>
<body class="font-sans text-gray-800">

  <!-- HERO -->
  <header class="hero h-screen flex items-center justify-center text-white text-center px-6">
    <div class="max-w-5xl">
      <h1 class="text-5xl md:text-7xl font-black mb-8 tracking-tight">College Softball Insights</h1>
      <p class="text-xl md:text-2xl max-w-4xl mx-auto leading-relaxed mb-10">
        Finding the right college softball program begins with clarity. Our tool helps parents and players narrow down options by location, conference, competitive level, enrollment size, class breakdown, retention rates, and coaching stability. Instead of feeling lost in endless choices, you’ll have a focused starting point to explore programs that truly match your priorities — making the first step in the recruiting process simpler, smarter, and more confident.
      </p>
      <a href="#search" class="inline-block bg-pink-600 hover:bg-pink-700 text-white font-bold py-5 px-12 rounded-full text-xl transition transform hover:scale-105">
        Start Your Search
      </a>
    </div>
  </header>

  <!-- AI SEARCH + FALLBACK FILTERS -->
  <section id="search" class="py-24 bg-gradient-to-b from-white to-gray-50">
    <div class="max-w-5xl mx-auto px-6 text-center">
      <h2 class="text-4xl md:text-6xl font-black mb-6">Ask Me Anything</h2>
      <p class="text-xl text-gray-600 mb-10 max-w-3xl mx-auto">
        Type exactly what you're looking for — no dropdowns needed.
      </p>
      <p class="text-lg text-gray-500 mb-8">Examples:<br>
        <em>“SEC teams in Texas adding lots of players”</em> · 
        <em>“Big Ten schools with 80%+ win rate in cold states”</em> · 
        <em>“warm weather programs with open catcher spots”</em>
      </p>

      <div class="relative max-w-4xl mx-auto">
        <input 
          type="text" 
          id="aiSearchInput" 
          placeholder="Describe your ideal program..." 
          class="w-full p-7 text-xl bg-white border-4 border-pink-200 rounded-3xl shadow-2xl focus:border-pink-600 focus:outline-none pr-24"
          autofocus />
        <button id="searchBtn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-pink-600 hover:bg-pink-700 text-white font-bold px-10 py-5 rounded-3xl transition">
          Search
        </button>
      </div>

      <p class="text-sm text-gray-500 mt-6">Powered by Grok • Real-time AI understanding</p>

      <!-- Optional: Show classic filters only on error -->
      <div id="filtersContainer" class="mt-16 hidden">
        <p class="text-gray-600 mb-6">Or use classic filters:</p>
        <div class="grid md:grid-cols-4 gap-6 max-w-5xl mx-auto">
          <select id="stateFilter" class="p-4 rounded-xl border"><option value="">Any State</option><option>TX</option><option>CA</option><option>FL</option><!-- etc --></select>
          <select id="confFilter" class="p-4 rounded-xl border"><option value="">Any Conference</option><option>SEC</option><option>Big Ten</option></select>
          <select id="growthFilter" class="p-4 rounded-xl border"><option value="">Any Growth</option><option value="12+">+12 or more</option><option value="10-11">+10–11</option></select>
          <select id="winFilter" class="p-4 rounded-xl border"><option value="">Any Win %</option><option value="0.85">85%+</option><option value="0.80">80–84%</option></select>
        </div>
      </div>
    </div>

    <!-- AI Explanation -->
    <div id="explanation" class="max-w-4xl mx-auto mt-12 p-8 bg-blue-50 rounded-2xl text-lg font-medium hidden"></div>

    <!-- Results Grid -->
    <div id="results" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10 mt-16 px-6"></div>
    <p class="text-center text-gray-500 mt-12 text-lg" id="noResults">Type a question above to see matches...</p>
  </section>

  <!-- TEAM DETAIL VIEW (unchanged – you already love this) -->
  <section id="teamDetails" class="py-20 bg-gray-50 hidden">
    <div class="max-w-6xl mx-auto px-6">
      <div class="text-center mb-10">
        <h2 id="detailTitle" class="text-5xl font-bold mb-4"></h2>
        <div id="netChange" class="inline-flex items-center px-6 py-3 rounded-full font-bold text-xl"></div>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl p-8 mb-12 overflow-hidden">
        <h3 class="text-3xl font-bold text-center mb-6">2025 → 2026 Roster Change Summary</h3>
        <p class="text-center text-gray-600 mb-8">Includes freshmen, transfers, and returners</p>
        <table class="w-full text-lg mb-8">
          <thead class="bg-gray-100"><tr><th class="p-5 text-left">Added</th><th class="p-5 text-left">Left</th><th class="p-5 text-left font-bold">Net Change</th></tr></thead>
          <tbody id="rosterChangeTable"></tbody>
        </table>
        <p class="text-center text-sm text-gray-600"><strong>Newcomers:</strong> <span id="newcomerBreakdown"></span></p>
      </div>

      <div class="grid md:grid-cols-2 gap-12 mb-12">
        <div class="bg-white p-8 rounded-2xl shadow-2xl"><canvas id="classChart"></canvas></div>
        <div class="bg-white p-8 rounded-2xl shadow-2xl"><canvas id="positionChart"></canvas></div>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
        <h3 class="text-3xl font-bold p-5 p-8 bg-pink-50 text-center">Full 2026 Roster</h3>
        <div class="overflow-x-auto">
          <table class="w-full" id="rosterTable">
            <thead class="bg-pink-100">
              <tr><th class="p-5 text-left">Player</th><th class="p-5 text-center">Pos</th><th class="p-5 text-center">Class</th></tr>
            </thead>
            <tbody class="divide-y"></tbody>
          </table>
        </div>
      </div>

      <button onclick="closeDetails()" class="mt-12 block mx-auto bg-pink-600 hover:bg-pink-700 text-white font-bold py-5 px-12 rounded-full text-xl transition">
        ← Back to Search
      </button>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-24 bg-pink-600 text-white text-center">
    <h2 class="text-5xl md:text-6xl font-black mb-6">Launch Special: $99 First Year</h2>
    <p class="text-2xl mb-10">Limited to first 100 families</p>
    <a href="#" class="bg-white text-pink-600 hover:bg-gray-100 font-black text-2xl py-6 px-16 rounded-full transition transform hover:scale-105">
      Claim Your Spot Now
    </a>
  </section>

  <footer class="bg-gray-900 text-white py-10 text-center text-sm">
    © 2025 College Softball Insights • Real-time roster data • Powered by Grok AI
  </footer>

  <script>
    let allTeams = [], fuse, classChart = null, positionChart = null;
    const XAI_API_KEY = 'YOUR_XAI_API_KEY_HERE'; // ← PUT YOUR KEY HERE
    const XAI_URL = 'https://api.x.ai/v1/chat/completions';

    fetch('teams.json')
      .then(r => r.json())
      .then(data => {
        allTeams = data;
        fuse = new Fuse(allTeams, {keys: ['name','conf','state'], threshold: 0.3});
        document.getElementById('noResults').textContent = 'Ask anything above ↑';
      });

    document.getElementById('searchBtn').addEventListener('click', runAISearch);
    document.getElementById('aiSearchInput').addEventListener('keypress', e => { if (e.key === 'Enter') runAISearch(); });

    async function runAISearch() {
      const query = document.getElementById('aiSearchInput').value.trim();
      if (!query) return;

      document.getElementById('noResults').textContent = 'Grok is thinking...';
      document.getElementById('results').innerHTML = '';
      document.getElementById('explanation').classList.add('hidden');

      try {
        const response = await fetch(XAI_URL, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${XAI_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: 'grok-beta',
            messages: [
              { role: 'system', content: `You are the world's best college softball recruiting expert. Given this dataset of 34 Power conference teams and the user's natural language request, return ONLY valid JSON with two keys: "matches" (array of matching team objects) and "explanation" (1-2 friendly sentences). Data: ${JSON.stringify(allTeams)}` },
              { role: 'user', content: query }
            ],
            temperature: 0.2,
            max_tokens: 1200
          })
        });

        const result = await response.json();
        const content = result.choices[0].message.content.trim();
        const { matches, explanation } = JSON.parse(content);

        renderResults(matches);
        document.getElementById('explanation').innerHTML = `<p class="text-xl">${explanation}</p>`;
        document.getElementById('explanation').classList.remove('hidden');
        document.getElementById('noResults').textContent = '';

      } catch (err => {
        console.error(err);
        document.getElementById('noResults').innerHTML = `AI search unavailable — using classic filters instead.<br><br>`;
        document.getElementById('filtersContainer').classList.remove('hidden');
        // fallback to your dropdown logic here if you want
      }
    }

    function renderResults(teams) {
      const container = document.getElementById('results');
      if (teams.length === 0) { container.innerHTML = '<p class="col-span-full text-center text-gray-500">No matches found.</p>'; return; }

      container.innerHTML = teams.map(team => {
        const total = Object.values(team.roster).reduce((a,b)=>a+b,0);
        const change = team.net > 0 ? `+${team.net}` : team.net;
        const color = team.net > 0 ? 'text-green-600' : team.net < 0 ? 'text-red-600' : 'text-gray-600';

        return `
          <div onclick="showTeam('${team.name.replace(/'/g, "\\'")}')" class="bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl hover:border-4 hover:border-pink-400 transition cursor-pointer text-center">
            <h3 class="text-3xl font-bold text-pink-600 mb-3">${team.name}</h3>
            <p class="text-xl mb-6">${team.conf} • ${team.state}</p>
            <div class="text-lg font-medium mb-6">
              <div>Win %: ${(team.winPct*100).toFixed(1)}%</div>
              <div>Newcomers: <strong>${team.newcomers}</strong></div>
            </div>
            <div class="text-2xl font-black bg-gray-100 rounded-full py-4 px-6 inline-block">
              ${total} <span class="text-pink-600">players</span> in 2026 
              <span class="${color}">(${change})</span>
            </div>
            <p class="mt-6 text-pink-600 font-bold">Tap for full roster →</p>
          </div>`;
      }).join('');
    }

    window.showTeam = function(name) {
      const team = allTeams.find(t => t.name === name);
      if (!team) return;
      document.getElementById('search').classList.add('hidden');
      document.getElementById('teamDetails').classList.remove('hidden');
      document.getElementById('detailTitle').textContent = team.name;

      const net = team.net;
      const netEl = document.getElementById('netChange');
      netEl.textContent = net > 0 ? `+${net} Net Growth` : `${net} Net Change`;
      netEl.className = net > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
      netEl.classList.add('px-6','py-3','rounded-full','font-bold','text-xl');

      // roster change table
      document.getElementById('rosterChangeTable').innerHTML = `
        <tr><td class="p-5">${team.newcomers} added (Fr + transfers)</td>
            <td class="p-5">${team.transfersOut || '—'}</td>
            <td class="p-5 font-bold text-2xl ${net>0?'text-green-600':'text-red-600'}">${net > 0 ? '+' : ''}${net}</td></tr>`;

      document.getElementById('newcomerBreakdown').textContent = `${team.newcomers} total (${team.roster.Fr} freshmen + ${team.transfersIn} transfers)`;

      // Charts
      if (classChart) classChart.destroy();
      if (positionChart) positionChart.destroy();
      classChart = new Chart(document.getElementById('classChart'), {
        type: 'doughnut',
        data: { labels: ['Fr','So','Jr','Sr','Gr'], datasets: [{ data: Object.values(team.roster), backgroundColor: ['#ff69b4','#ff1493','#c71585','#db7093','#ff6eb4'] }] },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
      positionChart = new Chart(document.getElementById('positionChart'), {
        type: 'doughnut',
        data: { labels: Object.keys(team.positions), datasets: [{ data: Object.values(team.positions), backgroundColor: ['#ff69b4','#ff1493','#c71585','#db7093'] }] },
        options: { plugins: { legend: { position: 'bottom' } } }
      });

      // Roster table
      const tbody = document.querySelector('#rosterTable tbody');
      tbody.innerHTML = team.players.map(p => `
        <tr class="hover:bg-pink-50">
          <td class="p-5">${p.name}</td>
          <td class="p-5 text-center font-medium">${p.pos}</td>
          <td class="p-5 text-center">${p.class}</td>
        </tr>`).join('');
    };

    function closeDetails() {
      document.getElementById('teamDetails').classList.add('hidden');
      document.getElementById('search').classList.remove('hidden');
      window.scrollTo(0,0);
    }
  </script>
</body>
</html>
